

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tastypie Cookbook &mdash; Tastypie v0.9.13-beta documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.13-beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Tastypie v0.9.13-beta documentation" href="index.html" />
    <link rel="next" title="Debugging Tastypie" href="debugging.html" />
    <link rel="prev" title="ContentTypes and GenericForeignKeys" href="content_types.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="debugging.html" title="Debugging Tastypie"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="content_types.html" title="ContentTypes and GenericForeignKeys"
             accesskey="P">previous</a> |</li>
        <li><a href="toc.html">Tastypie v0.9.13-beta documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tastypie-cookbook">
<span id="ref-cookbook"></span><h1>Tastypie Cookbook<a class="headerlink" href="#tastypie-cookbook" title="Permalink to this headline">¶</a></h1>
<div class="section" id="adding-custom-values">
<h2>Adding Custom Values<a class="headerlink" href="#adding-custom-values" title="Permalink to this headline">¶</a></h2>
<p>You might encounter cases where you wish to include additional data in a
response which is not obtained from a field or method on your model. You can
easily extend the <tt class="xref py py-meth docutils literal"><span class="pre">dehydrate()</span></tt> method to
provide additional values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyModelResource</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">dehydrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;custom_field&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Whatever you want&quot;</span>
        <span class="k">return</span> <span class="n">bundle</span>
</pre></div>
</div>
</div>
<div class="section" id="per-request-alterations-to-the-queryset">
<h2>Per-Request Alterations To The Queryset<a class="headerlink" href="#per-request-alterations-to-the-queryset" title="Permalink to this headline">¶</a></h2>
<p>A common pattern is needing to limit a queryset by something that changes
per-request, for instance the date/time. You can accomplish this by lightly
modifying <tt class="docutils literal"><span class="pre">get_object_list</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tastypie.utils</span> <span class="kn">import</span> <span class="n">now</span>

<span class="k">class</span> <span class="nc">MyResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">MyObject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_object_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">MyResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">start_date__gte</span><span class="o">=</span><span class="n">now</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-your-resource-in-regular-views">
<h2>Using Your <tt class="docutils literal"><span class="pre">Resource</span></tt> In Regular Views<a class="headerlink" href="#using-your-resource-in-regular-views" title="Permalink to this headline">¶</a></h2>
<p>In addition to using your resource classes to power the API, you can also use
them to write other parts of your application, such as your views. For
instance, if you wanted to encode user information in the page for some
Javascript&#8217;s use, you could do the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># views.py</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>
<span class="kn">from</span> <span class="nn">myapp.api.resources</span> <span class="kn">import</span> <span class="n">UserResource</span>


<span class="k">def</span> <span class="nf">user_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
    <span class="n">ur</span> <span class="o">=</span> <span class="n">UserResource</span><span class="p">()</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ur</span><span class="o">.</span><span class="n">obj_get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>

    <span class="c"># Other things get prepped to go into the context then...</span>

    <span class="n">ur_bundle</span> <span class="o">=</span> <span class="n">ur</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;myapp/user_detail.html&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="c"># Other things here.</span>
        <span class="s">&quot;user_json&quot;</span><span class="p">:</span> <span class="n">ur</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">ur</span><span class="o">.</span><span class="n">full_dehydrate</span><span class="p">(</span><span class="n">ur_bundle</span><span class="p">),</span> <span class="s">&#39;application/json&#39;</span><span class="p">),</span>
    <span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="using-non-pk-data-for-your-urls">
<h2>Using Non-PK Data For Your URLs<a class="headerlink" href="#using-non-pk-data-for-your-urls" title="Permalink to this headline">¶</a></h2>
<p>By convention, <tt class="docutils literal"><span class="pre">ModelResource</span></tt>s usually expose the detail endpoints utilizing
the primary key of the <tt class="docutils literal"><span class="pre">Model</span></tt> they represent. However, this is not a strict
requirement. Each URL can take other named URLconf parameters that can be used
for the lookup.</p>
<p>For example, if you want to expose <tt class="docutils literal"><span class="pre">User</span></tt> resources by username, you can do
something like the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># myapp/api/resources.py</span>
<span class="k">class</span> <span class="nc">UserResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">prepend_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;username&gt;[\w\d_.-]+)/$&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_detail&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_detail&quot;</span><span class="p">),</span>
        <span class="p">]</span>
</pre></div>
</div>
<p>The added URLconf matches before the standard URLconf included by default &amp;
matches on the username provided in the URL.</p>
</div>
<div class="section" id="nested-resources">
<h2>Nested Resources<a class="headerlink" href="#nested-resources" title="Permalink to this headline">¶</a></h2>
<p>You can also do &#8220;nested resources&#8221; (resources within another related resource)
by lightly overriding the <tt class="docutils literal"><span class="pre">prepend_urls</span></tt> method &amp; adding on a new method to
handle the children:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ParentResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToManyField</span><span class="p">(</span><span class="n">ChildResource</span><span class="p">,</span> <span class="s">&#39;children&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prepend_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;pk&gt;\w[\w/-]*)/children</span><span class="si">%s</span><span class="s">$&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="n">trailing_slash</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;get_children&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_get_children&quot;</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_obj_get</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_api_resource_names</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpGone</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">MultipleObjectsReturned</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpMultipleChoices</span><span class="p">(</span><span class="s">&quot;More than one resource is found at this URI.&quot;</span><span class="p">)</span>

        <span class="n">child_resource</span> <span class="o">=</span> <span class="n">ChildResource</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">child_resource</span><span class="o">.</span><span class="n">get_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">parent_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
</pre></div>
</div>
<p>Another alternative approach is to override the <tt class="docutils literal"><span class="pre">dispatch</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># myapp/api/resources.py</span>
<span class="k">class</span> <span class="nc">EntryResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserResource</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;entry&#39;</span>

    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">EntryResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">request_type</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c"># urls.py</span>
<span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">myapp.api</span> <span class="kn">import</span> <span class="n">EntryResource</span>

<span class="n">entry_resource</span> <span class="o">=</span> <span class="n">EntryResource</span><span class="p">()</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="c"># The normal jazz here, then...</span>
    <span class="p">(</span><span class="s">r&#39;^api/(?P&lt;username&gt;\w+)/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">entry_resource</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-search-functionality">
<h2>Adding Search Functionality<a class="headerlink" href="#adding-search-functionality" title="Permalink to this headline">¶</a></h2>
<p>Another common request is being able to integrate search functionality. This
approach uses <a class="reference external" href="http://haystacksearch.org/">Haystack</a>, though you could hook it up to any search technology.
We leave the CRUD methods of the resource alone, choosing to add a new endpoint
at <tt class="docutils literal"><span class="pre">/api/v1/notes/search/</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span><span class="p">,</span> <span class="n">InvalidPage</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">Http404</span>
<span class="kn">from</span> <span class="nn">haystack.query</span> <span class="kn">import</span> <span class="n">SearchQuerySet</span>
<span class="kn">from</span> <span class="nn">tastypie.resources</span> <span class="kn">import</span> <span class="n">ModelResource</span>
<span class="kn">from</span> <span class="nn">tastypie.utils</span> <span class="kn">import</span> <span class="n">trailing_slash</span>
<span class="kn">from</span> <span class="nn">notes.models</span> <span class="kn">import</span> <span class="n">Note</span>


<span class="k">class</span> <span class="nc">NoteResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Note</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;notes&#39;</span>

    <span class="k">def</span> <span class="nf">prepend_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/search</span><span class="si">%s</span><span class="s">$&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="n">trailing_slash</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;get_search&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_get_search&quot;</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_check</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">allowed</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">throttle_check</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c"># Do the query.</span>
        <span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">models</span><span class="p">(</span><span class="n">Note</span><span class="p">)</span><span class="o">.</span><span class="n">load_all</span><span class="p">()</span><span class="o">.</span><span class="n">auto_query</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;q&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">sqs</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">except</span> <span class="n">InvalidPage</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Http404</span><span class="p">(</span><span class="s">&quot;Sorry, no results on that page.&quot;</span><span class="p">)</span>

        <span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">object_list</span><span class="p">:</span>
            <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
            <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dehydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
            <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

        <span class="n">object_list</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;objects&#39;</span><span class="p">:</span> <span class="n">objects</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log_throttled_access</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">object_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-per-user-resources">
<h2>Creating per-user resources<a class="headerlink" href="#creating-per-user-resources" title="Permalink to this headline">¶</a></h2>
<p>One might want to create an API which will require every user to authenticate
and every user will be working only with objects associated with them. Let&#8217;s see
how to implement it for two basic operations: listing and creation of an object.</p>
<p>For listing we want to list only objects for which &#8216;user&#8217; field matches
&#8216;request.user&#8217;. This could be done by applying a filter in the <tt class="docutils literal"><span class="pre">apply_authorization_limits</span></tt>
method of your resource.</p>
<p>For creating we&#8217;d have to wrap <tt class="docutils literal"><span class="pre">obj_create</span></tt> method of <tt class="docutils literal"><span class="pre">ModelResource</span></tt>. Then the
resulting code will look something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># myapp/api/resources.py</span>
<span class="k">class</span> <span class="nc">EnvironmentResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;environment&#39;</span>
        <span class="n">list_allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;post&#39;</span><span class="p">]</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">ApiKeyAuthentication</span><span class="p">()</span>
        <span class="n">authorization</span> <span class="o">=</span> <span class="n">Authorization</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">obj_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">EnvironmentResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">obj_create</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_authorization_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">object_list</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">object_list</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="camelcase-json-serialization">
<h2>camelCase JSON Serialization<a class="headerlink" href="#camelcase-json-serialization" title="Permalink to this headline">¶</a></h2>
<p>The convention in the world of Javascript has standardized on camelCase,
where Tastypie uses underscore syntax, which can lead to &#8220;ugly&#8221; looking
code in Javascript. You can create a custom serializer that emits
values in camelCase instead:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tastypie.serializers</span> <span class="kn">import</span> <span class="n">Serializer</span>

<span class="k">class</span> <span class="nc">CamelCaseJSONSerializer</span><span class="p">(</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;json&#39;</span><span class="p">]</span>
    <span class="n">content_types</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;json&#39;</span><span class="p">:</span> <span class="s">&#39;application/json&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># Changes underscore_separated names to camelCase names to go from python convention to javacsript convention</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_simple</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">underscoreToCamel</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">camelize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">new_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">new_key</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;[a-z]_[a-z]&quot;</span><span class="p">,</span> <span class="n">underscoreToCamel</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                    <span class="n">new_dict</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">camelize</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">new_dict</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">camelize</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">data</span>
            <span class="k">return</span> <span class="n">data</span>

        <span class="n">camelized_data</span> <span class="o">=</span> <span class="n">camelize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">simplejson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">camelized_data</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="c"># Changes camelCase names to underscore_separated names to go from javascript convention to python convention</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">simplejson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">camelToUnderscore</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">underscorize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">new_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">new_key</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;[a-z][A-Z]&quot;</span><span class="p">,</span> <span class="n">camelToUnderscore</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                    <span class="n">new_dict</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">underscorize</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">new_dict</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">underscorize</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">data</span>
            <span class="k">return</span> <span class="n">data</span>

    <span class="n">underscored_data</span> <span class="o">=</span> <span class="n">underscorize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">underscored_data</span>
</pre></div>
</div>
</div>
<div class="section" id="pretty-printed-json-serialization">
<h2>Pretty-printed JSON Serialization<a class="headerlink" href="#pretty-printed-json-serialization" title="Permalink to this headline">¶</a></h2>
<p>By default, Tastypie outputs JSON with no indentation or newlines (equivalent to calling
<tt class="xref py py-func docutils literal"><span class="pre">json.dumps()</span></tt> with <em>indent</em> set to <tt class="xref docutils literal"><span class="pre">None</span></tt>). You can override this
behavior in a custom serializer:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.serializers</span> <span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">simplejson</span>
<span class="kn">from</span> <span class="nn">tastypie.serializers</span> <span class="kn">import</span> <span class="n">Serializer</span>

<span class="k">class</span> <span class="nc">PrettyJSONSerializer</span><span class="p">(</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">json_indent</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_simple</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">simplejson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">DjangoJSONEncoder</span><span class="p">,</span>
                <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">json_indent</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="determining-format-via-url">
<h2>Determining format via URL<a class="headerlink" href="#determining-format-via-url" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it&#8217;s required to allow selecting the response format by
specifying it in the API URL, for example <tt class="docutils literal"><span class="pre">/api/v1/users.json</span></tt> instead
of <tt class="docutils literal"><span class="pre">/api/v1/users/?format=json</span></tt>. The following snippet allows that kind
of syntax additional to the default URL scheme:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># myapp/api/resources.py</span>

<span class="c"># Piggy-back on internal csrf_exempt existence handling</span>
<span class="kn">from</span> <span class="nn">tastypie.resources</span> <span class="kn">import</span> <span class="n">csrf_exempt</span>

<span class="k">class</span> <span class="nc">UserResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">prepend_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a URL scheme based on the default scheme to specify</span>
<span class="sd">        the response format as a file extension, e.g. /api/v1/users.json</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)\.(?P&lt;format&gt;\w+)$&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_list&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_list&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/schema\.(?P&lt;format&gt;\w+)$&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;get_schema&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_get_schema&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/set/(?P&lt;pk_list&gt;\w[\w/;-]*)\.(?P&lt;format&gt;\w+)$&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;get_multiple&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_get_multiple&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;pk&gt;\w[\w/-]*)\.(?P&lt;format&gt;\w+)$&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_detail&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_detail&quot;</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">determine_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used to determine the desired format from the request.format</span>
<span class="sd">        attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;format&#39;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">request</span><span class="o">.</span><span class="n">format</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">serializer</span><span class="o">.</span><span class="n">formats</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">serializer</span><span class="o">.</span><span class="n">get_mime_for_format</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">UserResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">determine_format</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">wrap_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="nd">@csrf_exempt</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">request</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;format&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">wrapped_view</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">UserResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">wrapped_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-to-the-django-admin">
<h2>Adding to the Django Admin<a class="headerlink" href="#adding-to-the-django-admin" title="Permalink to this headline">¶</a></h2>
<p>If you&#8217;re using the django admin and ApiKeyAuthentication, you may want to see
or edit ApiKeys next to users. To do this, you need to unregister the built-in
UserAdmin, alter the inlines, and re-register it. This could go in any of your
admin.py files. You may also want to register ApiAccess and ApiKey models on
their own.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tastypie.admin</span> <span class="kn">import</span> <span class="n">ApiKeyInline</span>
<span class="kn">from</span> <span class="nn">tastypie.models</span> <span class="kn">import</span> <span class="n">ApiAccess</span><span class="p">,</span> <span class="n">ApiKey</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.admin</span> <span class="kn">import</span> <span class="n">UserAdmin</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ApiKey</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ApiAccess</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">UserModelAdmin</span><span class="p">(</span><span class="n">UserAdmin</span><span class="p">):</span>
    <span class="n">inlines</span> <span class="o">=</span> <span class="n">UserAdmin</span><span class="o">.</span><span class="n">inlines</span> <span class="o">+</span> <span class="p">[</span><span class="n">ApiKeyInline</span><span class="p">]</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">User</span><span class="p">,</span><span class="n">UserModelAdmin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-sessionauthentication">
<h2>Using <tt class="docutils literal"><span class="pre">SessionAuthentication</span></tt><a class="headerlink" href="#using-sessionauthentication" title="Permalink to this headline">¶</a></h2>
<p>If your users are logged into the site &amp; you want Javascript to be able to
access the API (assuming jQuery), the first thing to do is setup
<tt class="docutils literal"><span class="pre">SessionAuthentication</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">tastypie.authentication</span> <span class="kn">import</span> <span class="n">SessionAuthentication</span>
<span class="kn">from</span> <span class="nn">tastypie.resources</span> <span class="kn">import</span> <span class="n">ModelResource</span>


<span class="k">class</span> <span class="nc">UserResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;users&#39;</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">SessionAuthentication</span><span class="p">()</span>
</pre></div>
</div>
<p>Then you&#8217;d build a template like:</p>
<div class="highlight-python"><pre>&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;&lt;/title&gt;
        &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript"&gt;
            $(document).ready(function() {
                // We use ``.ajax`` here due to the overrides.
                $.ajax({
                    // Substitute in your API endpoint here.
                    url: '/api/v1/users/',
                    contentType: 'application/json',
                    // The ``X-CSRFToken`` evidently can't be set in the
                    // ``headers`` option, so force it here.
                    // This method requires jQuery 1.5+.
                    beforeSend: function(jqXHR, settings) {
                        // Pull the token out of the DOM.
                        jqXHR.setRequestHeader('X-CSRFToken', $('input[name=csrfmiddlewaretoken]').val());
                    },
                    success: function(data, textStatus, jqXHR) {
                        // Your processing of the data here.
                        console.log(data);
                    }
                });
            });
        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;!-- Include the CSRF token in the body of the HTML --&gt;
        {% csrf_token %}
    &lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<p>There are other ways to make this function, with other libraries or other
techniques for supplying the token (see
<a class="reference external" href="https://docs.djangoproject.com/en/dev/ref/contrib/csrf/#ajax">https://docs.djangoproject.com/en/dev/ref/contrib/csrf/#ajax</a> for an
alternative). This is simply a starting point for getting things working.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="toc.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tastypie Cookbook</a><ul>
<li><a class="reference internal" href="#adding-custom-values">Adding Custom Values</a></li>
<li><a class="reference internal" href="#per-request-alterations-to-the-queryset">Per-Request Alterations To The Queryset</a></li>
<li><a class="reference internal" href="#using-your-resource-in-regular-views">Using Your <tt class="docutils literal"><span class="pre">Resource</span></tt> In Regular Views</a></li>
<li><a class="reference internal" href="#using-non-pk-data-for-your-urls">Using Non-PK Data For Your URLs</a></li>
<li><a class="reference internal" href="#nested-resources">Nested Resources</a></li>
<li><a class="reference internal" href="#adding-search-functionality">Adding Search Functionality</a></li>
<li><a class="reference internal" href="#creating-per-user-resources">Creating per-user resources</a></li>
<li><a class="reference internal" href="#camelcase-json-serialization">camelCase JSON Serialization</a></li>
<li><a class="reference internal" href="#pretty-printed-json-serialization">Pretty-printed JSON Serialization</a></li>
<li><a class="reference internal" href="#determining-format-via-url">Determining format via URL</a></li>
<li><a class="reference internal" href="#adding-to-the-django-admin">Adding to the Django Admin</a></li>
<li><a class="reference internal" href="#using-sessionauthentication">Using <tt class="docutils literal"><span class="pre">SessionAuthentication</span></tt></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="content_types.html"
                        title="previous chapter">ContentTypes and GenericForeignKeys</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="debugging.html"
                        title="next chapter">Debugging Tastypie</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/cookbook.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="debugging.html" title="Debugging Tastypie"
             >next</a> |</li>
        <li class="right" >
          <a href="content_types.html" title="ContentTypes and GenericForeignKeys"
             >previous</a> |</li>
        <li><a href="toc.html">Tastypie v0.9.13-beta documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2013, Daniel Lindsley, Cody Soyland, Matt Croydon, Josh Bohde &amp; Issac Kelly.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>